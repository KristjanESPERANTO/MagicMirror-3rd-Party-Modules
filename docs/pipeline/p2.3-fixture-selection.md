# P2.3 Fixture Selection (Phase 0)

_Last updated: October 1, 2025_

This document enumerates the repositories we will copy into `fixtures/modules/` for the comparison harness. The goal is to guarantee that every rule in the legacy `check_modules.py` stage has at least one deterministic trigger before we port it to TypeScript.

## 1. Curated module list

| Fixture slug                        | Type            | Primary coverage                          | Rule IDs                                                                                                                                                                                                                                                               | Status | Notes                                                                                                                                  |
| ----------------------------------- | --------------- | ----------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| `baseline-mmm-01zm`                 | Real (snapshot) | Smoke test, zero findings                 | _None_                                                                                                                                                                                                                                                                 | Ready  | Snapshot stored under `fixtures/modules/baseline-mmm-01zm` (`1bfc72e` from upstream).                                                  |
| `baseline-mmm-airquality`           | Real (snapshot) | Regression guard (weather module)         | _None_                                                                                                                                                                                                                                                                 | Ready  | Snapshot stored under `fixtures/modules/baseline-mmm-airquality` (`2641834` HEAD captured via `updateBaselineShas.js`).                |
| `baseline-mmm-admin-interface`      | Real (snapshot) | Regression guard, README heuristics       | `detect-missing-install-section`, `detect-missing-update-section`, duplicate keywords                                                                                                                                                                                  | Ready  | Snapshot stored under `fixtures/modules/baseline-mmm-admin-interface` (`df92c75` HEAD captured via `updateBaselineShas.js`).           |
| `baseline-mmm-actual`               | Real (snapshot) | License mismatches + npm metadata         | License mismatch, invalid SPDX license                                                                                                                                                                                                                                 | Ready  | Snapshot stored under `fixtures/modules/baseline-mmm-actual` (`2a561a9` HEAD captured via `updateBaselineShas.js`).                    |
| `synthetic-deprecated-node-api`     | Synthetic       | Legacy Node API usage                     | `text-deprecated-new-buffer`, `text-deprecated-fs-*`, `text-deprecated-getYear`, `text-deprecated-node-version`, `text-recommend-actions-checkout`, `text-recommend-actions-setup-node`                                                                                | Ready  | Repository populated under `fixtures/modules/synthetic-deprecated-node-api`.                                                           |
| `synthetic-deprecated-http-clients` | Synthetic       | Request/axios deprecations                | `text-deprecated-request*`, `text-recommend-axios`, `text-recommend-node-fetch`, `text-recommend-require-fetch`, `text-recommend-http-module`, `text-recommend-https-module`                                                                                           | Ready  | Repository populated under `fixtures/modules/synthetic-deprecated-http-clients`.                                                       |
| `synthetic-network-apis`            | Synthetic       | CDN/OpenWeather recommendations           | `text-recommend-cdn-*`, `text-deprecated-openweathermap`                                                                                                                                                                                                               | Ready  | Repository populated under `fixtures/modules/synthetic-network-apis`.                                                                  |
| `synthetic-typo-branding`           | Synthetic       | MagicMirror typos                         | `text-typo-*`, `text-outdated-michmich`                                                                                                                                                                                                                                | Ready  | Repository populated under `fixtures/modules/synthetic-typo-branding`.                                                                 |
| `synthetic-github-actions`          | Synthetic       | Actions upgrade recommendations           | `text-recommend-actions-checkout`, `text-recommend-actions-setup-node`                                                                                                                                                                                                 | Ready  | Repository populated under `fixtures/modules/synthetic-github-actions`.                                                                |
| `synthetic-npm-metadata`            | Synthetic       | Deprecated npm packages                   | `pkg-deprecated-electron-rebuild`, `pkg-deprecated-eslint-config-airbnb`, `pkg-recommend-eslint-plugin-json`, `pkg-deprecated-grunt`, `pkg-outdated-husky-install`, `pkg-recommend-needle`, `pkg-deprecated-rollup-banner`, `pkg-deprecated-stylelint-config-prettier` | Ready  | Repository populated under `fixtures/modules/synthetic-npm-metadata`.                                                                  |
| `synthetic-lockfile`                | Synthetic       | Legacy lockfile versions                  | `lock-deprecated-v1`, `lock-deprecated-v2`                                                                                                                                                                                                                             | Ready  | Repository populated under `fixtures/modules/synthetic-lockfile`.                                                                      |
| `synthetic-readme-heuristics`       | Synthetic       | README structure + node_modules detection | `detect-missing-install-section`, `detect-missing-update-section`, `detect-node_modules-dir`                                                                                                                                                                           | Ready  | Repository populated under `fixtures/modules/synthetic-readme-heuristics`.                                                             |
| `synthetic-jquery-local`            | Synthetic       | Local jQuery copy                         | `detect-jquery-local-copy`                                                                                                                                                                                                                                             | Ready  | Repository populated under `fixtures/modules/synthetic-jquery-local` with a placeholder `jquery.min.js`.                               |
| `synthetic-eslint-helper`           | Synthetic       | ESLint integration                        | `eslint_checks`                                                                                                                                                                                                                                                        | Ready  | Repository populated under `fixtures/modules/synthetic-eslint-helper` with a legacy `.eslintrc.json` and lint failures.                |
| `synthetic-deprecation-helper`      | Synthetic       | npm deprecated packages via helper        | `deprecation_check`                                                                                                                                                                                                                                                    | Ready  | Repository populated under `fixtures/modules/synthetic-deprecation-helper`; harness may stub `npm-deprecated-check` output if offline. |

## 2. Coverage matrix

| Category                       | Fixtures                                                                                       |
| ------------------------------ | ---------------------------------------------------------------------------------------------- |
| Text scanning – Deprecated     | `synthetic-deprecated-node-api`, `synthetic-deprecated-http-clients`, `synthetic-network-apis` |
| Text scanning – Recommendation | `synthetic-deprecated-http-clients`, `synthetic-network-apis`, `synthetic-github-actions`      |
| Text scanning – Typo/Outdated  | `synthetic-typo-branding`, `synthetic-deprecated-node-api`                                     |
| Package.json checks            | `synthetic-npm-metadata`, `synthetic-deprecation-helper`                                       |
| Package-lock checks            | `synthetic-lockfile`                                                                           |
| File-system heuristics         | `baseline-mmm-admin-interface`, `synthetic-readme-heuristics`, `synthetic-jquery-local`        |
| External helpers               | `synthetic-eslint-helper`, `synthetic-deprecation-helper`, `baseline-mmm-actual`               |
| Baseline controls              | `baseline-mmm-01zm`, `baseline-mmm-airquality` (reuse from schema fixtures)                    |

_Notes:_

- `baseline-mmm-airquality` is already part of the schema fixtures dataset. We will keep the same snapshot under `fixtures/modules/` so the harness can reuse it without reaching into the generator outputs.
- Some fixtures pull double duty; for example `synthetic-deprecated-node-api` covers both deprecated patterns and the GitHub Actions workflow rule by embedding `uses: actions/checkout@v2` in the same repository. Where rules share a fixture, document the exact file and expectation in each `FIXTURE.md`.
- The `synthetic-deprecation-helper` repository requires the harness to install dependencies (or stub the `npm-deprecated-check` response). See open questions below.

## 3. Implementation steps

- [x] **Snapshot real modules** – use `git subtree` or a manual archive to copy the selected upstream modules into `fixtures/modules/baseline-*`, trimming unnecessary files.
- [x] **Author synthetic fixtures** – scaffold the synthetic repositories described above. Start with text scanning and package metadata since they do not require external tooling.
- [x] **Document expectations** – add `FIXTURE.md` to every module, listing the rule IDs and the files that trigger them.
- [x] **Update generator** – extend the fixture generator to pull from these repositories when building `fixtures/data/` so Stage 5 outputs reflect the new coverage.
- [x] **Wire harness inputs** – the `check-modules:compare` CLI executes the configured legacy/TS commands, captures Stage 5 artifacts, and diffs the outputs (Stage 5 + stats). The harness now runs in CI via the dedicated workflow; filtering support for larger fixture batches is tracked as a follow-up.

## 4. Open questions / follow-ups

- Do we simulate network access for `deprecation_check`, or should we record the npm response in a fixture file and stub the helper? (Impacts offline determinism.)
- Should `synthetic-lockfile` store both lockfile versions in a single repository or split them into separate fixtures for clarity?
- How do we keep upstream baseline snapshots fresh without bloating the repository? Consider tooling to re-fetch them on demand while storing trimmed copies in Git.

Once the fixtures are populated, update this document with commit SHAs or tags for each entry and mark the status column as **Ready**.
