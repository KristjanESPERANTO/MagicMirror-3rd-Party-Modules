# P2.3 Rule Inventory (Phase 0)

_Last updated: October 1, 2025_

This document captures the existing checks implemented in the Python `check_modules.py` stage and groups them into categories. It serves as the source of truth for the rule registry that powers the TypeScript implementation (see `p2.3-rule-registry.schema.json`).

> **Note:** The TypeScript checker (`scripts/check-modules/index.ts`) is now the default enforcement stage. This inventory remains aligned with the Python fallback so investigative runs stay comparable.

## 1. Text scanning rules (general files)

| Rule ID                           | Pattern                                     | Category       | Notes                        |
| --------------------------------- | ------------------------------------------- | -------------- | ---------------------------- |
| text-deprecated-new-buffer        | `new Buffer(`                               | Deprecated     | Replace with `Buffer.from`.  |
| text-deprecated-fs-F_OK           | `fs.F_OK`                                   | Deprecated     | Use `fs.constants.F_OK`.     |
| text-deprecated-fs-R_OK           | `fs.R_OK`                                   | Deprecated     | Use `fs.constants.R_OK`.     |
| text-deprecated-fs-W_OK           | `fs.W_OK`                                   | Deprecated     | Use `fs.constants.W_OK`.     |
| text-deprecated-fs-X_OK           | `fs.X_OK`                                   | Deprecated     | Use `fs.constants.X_OK`.     |
| text-typo-magic-mirror            | `Magic Mirror`                              | Typo           | Should be `MagicMirror²`.    |
| text-typo-magicmirror2            | `MagicMirror2`                              | Typo           | Should be `MagicMirror²`.    |
| text-typo-magicmirror-brackets    | `[MagicMirror]`                             | Typo           | Should be `[MagicMirror²]`.  |
| text-typo-html-sub2               | `<sub>2</sub>`                              | Typo           | Replace with `²`.            |
| text-deprecated-request           | `require("request")` (and variants)         | Deprecated     | Replace with built-in fetch. |
| text-deprecated-request-promise   | `require("request-promise")` (and variants) | Deprecated     | Replace with fetch.          |
| text-deprecated-native-request    | `require("native-request")`                 | Deprecated     | Replace with fetch.          |
| text-recommend-http-module        | `require("http")`/`require('http')`         | Recommendation | Use `node:http`.             |
| text-recommend-https-module       | `require("https")`/`require('https')`       | Recommendation | Use `node:https`.            |
| text-recommend-node-fetch         | `'node-fetch'`/`"node-fetch"`               | Recommendation | Use built-in fetch.          |
| text-recommend-require-fetch      | `require("fetch")`/`require('fetch')`       | Recommendation | Use built-in fetch.          |
| text-recommend-axios              | `axios`                                     | Recommendation | Suggest fetch.               |
| text-deprecated-omxplayer         | `omxplayer`                                 | Deprecated     | Suggest `mplayer` or `vlc`.  |
| text-recommend-xmlhttprequest     | `XMLHttpRequest`                            | Recommendation | Suggest fetch.               |
| text-recommend-actions-checkout   | `uses: actions/checkout@v2`/`@v3`/`@v4`     | Recommendation | Upgrade to v5.               |
| text-recommend-actions-setup-node | `uses: actions/setup-node@v3`               | Recommendation | Upgrade to v4.               |
| text-deprecated-node-version      | `node-version: 14/16/18` (variants)         | Deprecated     | Upgrade to current LTS.      |
| text-recommend-npm-run            | `npm run`                                   | Recommendation | Prefer `node --run`.         |
| text-recommend-jshint             | `jshint`                                    | Recommendation | Suggest ESLint.              |
| text-deprecated-getYear           | `getYear()`                                 | Deprecated     | Use `getFullYear()`.         |
| text-outdated-michmich            | `MichMich/MagicMirror`                      | Outdated       | Update org name.             |
| text-outdated-husky               | `/_/husky.sh`                               | Outdated       | Husky v9 change.             |
| text-deprecated-openweathermap    | `api.openweathermap.org/data/2.5`           | Deprecated     | Upgrade to API 3.0.          |
| text-recommend-cdn-cdnjs          | `https://cdnjs.cloudflare.com`              | Recommendation | Prefer local npm package.    |
| text-recommend-cdn-jsdelivr       | `https://cdn.jsdelivr.net`                  | Recommendation | Prefer local npm package.    |
| text-recommend-eslint-dot         | `eslint .` / `eslint --fix .`               | Recommendation | Drop trailing dot.           |
| text-recommend-git-checkout       | `git checkout`                              | Recommendation | Switch to `git switch`.      |

## 2. Package.json-specific rules

| Rule ID                                  | Pattern                                      | Category       | Notes                             |
| ---------------------------------------- | -------------------------------------------- | -------------- | --------------------------------- |
| pkg-deprecated-electron-rebuild          | `"electron-rebuild"`                         | Deprecated     | Use `@electron/rebuild`.          |
| pkg-deprecated-eslint-config-airbnb      | `eslint-config-airbnb`                       | Deprecated     | Seek modern configuration.        |
| pkg-recommend-eslint-plugin-json         | `"eslint-plugin-json"`/`eslint-plugin-jsonc` | Recommendation | Suggest `@eslint/json`.           |
| pkg-deprecated-grunt                     | `"grunt"`                                    | Deprecated     | Tool largely unmaintained.        |
| pkg-outdated-husky-install               | `husky install`                              | Outdated       | Husky v9 no longer needs it.      |
| pkg-recommend-needle                     | `"needle"`                                   | Recommendation | Suggest fetch.                    |
| pkg-deprecated-rollup-banner             | `rollup-plugin-banner`                       | Deprecated     | Replace with built-in banner.     |
| pkg-deprecated-stylelint-config-prettier | `stylelint-config-prettier`                  | Deprecated     | Remove in newer Stylelint setups. |

## 3. Package-lock-specific rules

| Rule ID            | Pattern                | Category   | Notes                    |
| ------------------ | ---------------------- | ---------- | ------------------------ |
| lock-deprecated-v1 | `"lockfileVersion": 1` | Deprecated | Encourage upgrade to v3. |
| lock-deprecated-v2 | `"lockfileVersion": 2` | Deprecated | Encourage upgrade to v3. |

## 4. File-system heuristics

(Not strictly part of the text scanning registry but relevant for migration.)

| Heuristic                      | Description                                                     | Notes                                        |
| ------------------------------ | --------------------------------------------------------------- | -------------------------------------------- |
| detect-node_modules-dir        | Flags first-level `node_modules` directories under module root. | Creates issue about ignoring `node_modules`. |
| detect-jquery-local-copy       | Looks for local `jquery.js` and warns about outdated versions.  | Also checks version strings `jQuery v3.7+`.  |
| detect-missing-update-section  | Ensures README contains `## Update`.                            | Recommendation.                              |
| detect-missing-install-section | Ensures README contains `## Install`.                           | Recommendation.                              |

## 5. External helpers

- `deprecation_check` module: runs `npm-deprecated-check` and aggregates results.
- `eslint_checks` module: executes ESLint with curated configuration to produce findings.
- Additional statistics gathering: counts issues, modules with images, hoster info, etc.

## 6. Open Questions

- Should CDN findings be split by host for severity weighting?
- How will we tag auto-fixable rules in the registry (ties into P4.1)?
- Do we normalize case sensitivity for patterns (some rules rely on lowercase matches only)?

---

This inventory will be refined during Phase 1 as we formalize the registry schema and begin porting the rules to TypeScript.
