{
  "version": "2025-09-28",
  "pipelines": [
    {
      "id": "full-refresh",
      "description": "Full catalogue refresh mirroring the current `node --run all` sequence.",
      "stages": [
        "collect-metadata",
        "get-modules",
        "expand-module-list",
        "check-modules"
      ]
    },
    {
      "id": "full-refresh-parallel",
      "description": "Full catalogue refresh using parallel worker pool (P7.3).",
      "stages": ["collect-metadata", "parallel-processing"]
    }
  ],
  "artifacts": [
    {
      "id": "modules-stage-1",
      "type": "file",
      "path": "website/data/modules.stage.1.json",
      "format": "json",
      "description": "Normalized module list generated from the MagicMirror wiki.",
      "schema": "dist/schemas/modules.stage.1.schema.json"
    },
    {
      "id": "github-api-cache",
      "type": "file",
      "path": "website/data/gitHubData.json",
      "format": "json",
      "description": "Cached repository metadata fetched from GitHub/GitLab/Bitbucket/Codeberg APIs."
    },
    {
      "id": "module-result-cache",
      "type": "file",
      "path": "website/data/moduleCache.json",
      "format": "json",
      "description": "Cached analysis results per module for incremental checking (P3.1.5)."
    },
    {
      "id": "modules-stage-2",
      "type": "file",
      "path": "website/data/modules.stage.2.json",
      "format": "json",
      "description": "Module list enriched with repository metadata.",
      "schema": "dist/schemas/modules.stage.2.schema.json"
    },
    {
      "id": "skipped-modules",
      "type": "file",
      "path": "website/data/skipped_modules.json",
      "format": "json",
      "description": "Modules that could not be cloned or validated."
    },
    {
      "id": "modules-stage-3",
      "type": "file",
      "path": "website/data/modules.stage.3.json",
      "format": "json",
      "description": "Validated modules that were successfully cloned.",
      "schema": "dist/schemas/modules.stage.3.schema.json"
    },
    {
      "id": "cloned-modules",
      "type": "directory",
      "path": "modules/",
      "description": "Working tree containing shallow clones of each module repository."
    },
    {
      "id": "modules-temp",
      "type": "directory",
      "path": "modules_temp/",
      "description": "Cache of module clones from the previous run; recycled by the pipeline to avoid full re-clones."
    },
    {
      "id": "modules-stage-4",
      "type": "file",
      "path": "website/data/modules.stage.4.json",
      "format": "json",
      "description": "Module list enriched with package.json metadata and image references.",
      "schema": "dist/schemas/modules.stage.4.schema.json"
    },
    {
      "id": "images-catalogue",
      "type": "directory",
      "path": "website/images/",
      "description": "Resized module screenshots exported for the public catalogue."
    },
    {
      "id": "modules-stage-5",
      "type": "file",
      "path": "website/data/modules.stage.5.json",
      "format": "json",
      "description": "Module list annotated with JavaScript-level checks.",
      "schema": "dist/schemas/modules.stage.5.schema.json"
    },
    {
      "id": "analysis-report",
      "type": "file",
      "path": "website/result.md",
      "format": "markdown",
      "description": "Human-readable summary of module issues and statistics."
    },
    {
      "id": "modules-json",
      "type": "file",
      "path": "website/data/modules.json",
      "format": "json",
      "description": "Final module catalogue powering downstream consumers.",
      "schema": "dist/schemas/modules.final.schema.json"
    },
    {
      "id": "modules-json-min",
      "type": "file",
      "path": "website/data/modules.min.json",
      "format": "json",
      "description": "Minified variant of the module catalogue.",
      "schema": "dist/schemas/modules.min.schema.json"
    },
    {
      "id": "stats-json",
      "type": "file",
      "path": "website/data/stats.json",
      "format": "json",
      "description": "Aggregated metrics collected during analysis.",
      "schema": "dist/schemas/stats.schema.json"
    }
  ],
  "stages": [
    {
      "id": "collect-metadata",
      "name": "Collect Metadata",
      "description": "Unified stage: Fetch module list from Wiki and enrich with repository metadata.",
      "command": {
        "executable": "node",
        "args": ["scripts/collect-metadata/index.js"]
      },
      "dependsOn": [],
      "inputs": [
        {
          "type": "external",
          "kind": "http",
          "uri": "https://raw.githubusercontent.com/wiki/MagicMirrorOrg/MagicMirror/3rd-Party-Modules.md",
          "description": "Authoritative list of community modules maintained in the MagicMirror wiki."
        },
        {
          "artifact": "github-api-cache",
          "mode": "read",
          "optional": true
        }
      ],
      "outputs": [
        {
          "artifact": "modules-stage-2",
          "mode": "write"
        },
        {
          "artifact": "github-api-cache",
          "mode": "write"
        }
      ],
      "sideEffects": [
        {
          "type": "network",
          "description": "Fetches Wiki and makes API calls to GitHub/GitLab/etc."
        }
      ],
      "environment": [
        {
          "name": "GITHUB_TOKEN",
          "required": false,
          "description": "Personal access token used to increase API rate limits."
        }
      ]
    },
    {
      "id": "get-modules",
      "name": "Fetch module repositories",
      "description": "Clone or update module repositories, validating access and producing the next-stage manifest.",
      "command": {
        "executable": "node",
        "args": ["scripts/get-modules.ts"]
      },
      "dependsOn": ["collect-metadata"],
      "inputs": [
        {
          "artifact": "modules-stage-2",
          "mode": "read"
        },
        {
          "artifact": "modules-temp",
          "mode": "read",
          "optional": true
        }
      ],
      "outputs": [
        {
          "artifact": "modules-stage-3",
          "mode": "write"
        },
        {
          "artifact": "skipped-modules",
          "mode": "write",
          "optional": true
        },
        {
          "artifact": "cloned-modules",
          "mode": "write"
        },
        {
          "artifact": "modules-temp",
          "mode": "write"
        }
      ],
      "sideEffects": [
        {
          "type": "network",
          "description": "HEAD requests against repository URLs to validate reachability."
        },
        {
          "type": "git",
          "description": "Performs shallow clones and pulls for each module repository (Git)."
        },
        {
          "type": "filesystem",
          "description": "Renames existing `modules` directory to `modules_temp` before refreshing clones."
        }
      ]
    },
    {
      "id": "expand-module-list",
      "name": "Enrich with package metadata",
      "description": "Parse each module's package.json, generate screenshots, and append derived metadata.",
      "command": {
        "executable": "node",
        "args": ["scripts/expand_module_list_with_repo_data.js"]
      },
      "dependsOn": ["get-modules"],
      "inputs": [
        {
          "artifact": "modules-stage-3",
          "mode": "read"
        },
        {
          "artifact": "cloned-modules",
          "mode": "read"
        }
      ],
      "outputs": [
        {
          "artifact": "modules-stage-4",
          "mode": "write"
        },
        {
          "artifact": "images-catalogue",
          "mode": "write"
        }
      ],
      "sideEffects": [
        {
          "type": "filesystem",
          "description": "Deletes the existing `website/images` directory before exporting resized screenshots."
        }
      ]
    },
    {
      "id": "check-modules",
      "name": "Deep repository analysis",
      "description": "Perform full module analysis, produce public datasets, and compile the Markdown report.",
      "command": {
        "executable": "node",
        "args": ["scripts/check-modules/index.ts"]
      },
      "dependsOn": ["expand-module-list"],
      "inputs": [
        {
          "artifact": "modules-stage-4",
          "mode": "read"
        },
        {
          "artifact": "cloned-modules",
          "mode": "read"
        },
        {
          "artifact": "module-result-cache",
          "mode": "read",
          "optional": true
        }
      ],
      "outputs": [
        {
          "artifact": "analysis-report",
          "mode": "write"
        },
        {
          "artifact": "modules-json",
          "mode": "write"
        },
        {
          "artifact": "modules-json-min",
          "mode": "write"
        },
        {
          "artifact": "stats-json",
          "mode": "write"
        },
        {
          "artifact": "module-result-cache",
          "mode": "write"
        }
      ],
      "sideEffects": [
        {
          "type": "process",
          "description": "Invokes Git, npm, npm-check-updates, eslint, and custom helper scripts inside each module clone."
        },
        {
          "type": "network",
          "description": "Commands like `npm-check-updates` may query the npm registry for latest package metadata."
        }
      ]
    },
    {
      "id": "parallel-processing",
      "name": "Parallel module processing",
      "description": "Clone, enrich, and analyze modules in parallel using worker pool (stages 3+4+5 combined).",
      "command": {
        "executable": "node",
        "args": ["scripts/parallel-processing.js"]
      },
      "dependsOn": ["collect-metadata"],
      "inputs": [
        {
          "artifact": "modules-stage-2",
          "mode": "read"
        }
      ],
      "outputs": [
        {
          "artifact": "modules-stage-5",
          "mode": "write"
        },
        {
          "artifact": "cloned-modules",
          "mode": "write"
        },
        {
          "artifact": "images-catalogue",
          "mode": "write"
        },
        {
          "artifact": "modules-json",
          "mode": "write"
        },
        {
          "artifact": "modules-json-min",
          "mode": "write"
        },
        {
          "artifact": "stats-json",
          "mode": "write"
        }
      ],
      "sideEffects": [
        {
          "type": "filesystem",
          "description": "Creates/updates module clones in modules/ and modules_temp/."
        },
        {
          "type": "filesystem",
          "description": "Generates resized module screenshots in website/images/."
        },
        {
          "type": "process",
          "description": "Spawns worker processes for parallel module processing."
        },
        {
          "type": "network",
          "description": "Git operations and npm commands may access external resources."
        }
      ]
    }
  ]
}
